<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Admin - Notifications</title>
  <script>
    async function fetchLogs() {
      const res = await fetch('/api/v1/notifications/logs');
      const logs = await res.json();
      const tbody = document.getElementById('logs-body');
      tbody.innerHTML = '';
      logs.forEach(l => {
        const row = `<tr>
          <td>${l.createdAt}</td>
          <td>${l.passengerId}</td>
          <td>${l.email}</td>
          <td>${l.type}</td>
          <td>${l.subject}</td>
          <td>${l.status}</td>
          <td>${l.details}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    async function sendManual() {
      const body = {
        passengerId: document.getElementById('passengerId').value,
        type: document.getElementById('type').value,
        subject: document.getElementById('subject').value,
        attachPdf: document.getElementById('attachPdf').checked,
        sendSms: document.getElementById('sendSms').checked
      };
      // You can send template vars as needed via a JSON field; keep simple
      await fetch('/api/v1/notifications/advanced/send', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      alert('Request sent — check logs');
      fetchLogs();
    }

    window.onload = () => {
      fetchLogs();
    };
  </script>
</head>
<body>
  <h1>Admin — Notifications</h1>

  <div>
    <h3>Send Manual Notification</h3>
    <label>Passenger ID: <input id="passengerId"/></label><br/>
    <label>Type:
      <select id="type">
        <option value="BOOKING_CONFIRMATION">BOOKING_CONFIRMATION</option>
        <option value="TICKET">TICKET</option>
        <option value="CANCELLATION">CANCELLATION</option>
        <option value="DELAY">DELAY</option>
      </select>
    </label><br/>
    <label>Subject: <input id="subject"/></label><br/>
    <label>Attach PDF: <input id="attachPdf" type="checkbox"/></label><br/>
    <label>Send SMS: <input id="sendSms" type="checkbox"/></label><br/>
    <button onclick="sendManual()">Send</button>
  </div>

  <h3>Logs</h3>
  <table border="1">
    <thead><tr><th>Date</th><th>Passenger</th><th>Email</th><th>Type</th><th>Subject</th><th>Status</th><th>Details</th></tr></thead>
    <tbody id="logs-body"></tbody>
  </table>
</body>
</html>
